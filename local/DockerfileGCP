FROM apache/beam_python3.8_sdk:2.27.0

ENV GOOGLE_APPLICATION_CREDENTIALS="./local/credenciales/alicorp-sandbox-dataflow-poc.json"

RUN ln -sf /usr/share/zoneinfo/America/Lima /etc/localtime




WORKDIR /app

RUN \
	apt-get install libpq-dev

COPY requirements.txt .

RUN \
	pip install pip==20.0.2 && \
	pip install -r requirements.txt

RUN \
	PYTHONDONTWRITEBYTECODE=True \
	export PYTHONDONTWRITEBYTECODE

COPY . /app

RUN mkdir -p tmp


RUN gcloud auth activate-service-account --key-file=./local/credenciales/alicorp-sandbox-dataflow-poc.json 

RUN gcloud auth list

CMD \
	python main.py